<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Financeiro</title>

<style>
body { margin: 0; font-family: Arial; display: flex; background: #f1f5f9; }
.sidebar {
  width: 240px; background: #0f172a; color: #fff;
  padding: 20px; height: 100vh; position: fixed;
}
.sidebar a {
  color: #fff; text-decoration: none;
  display: block; padding: 10px;
  border-radius: 6px;
}
.sidebar a:hover { background: #334155; }

.main { margin-left: 240px; padding: 30px; width: 100%; }

.card {
  background: #fff; padding: 20px;
  border-radius: 12px; margin-bottom: 20px;
  box-shadow: 0 5px 20px rgba(0,0,0,.1);
}

.resumo {
  display: flex; gap: 20px;
}
.box {
  flex: 1; padding: 20px;
  border-radius: 12px; color: #fff;
}
.recebido { background: #16a34a; }
.receber { background: #ca8a04; }

table { width: 100%; border-collapse: collapse; margin-top: 15px; }
th, td { border: 1px solid #ccc; padding: 8px; }
th { background: #f1f5f9; }
</style>
</head>

<body>

<div class="sidebar">
  <h3>ðŸ›  Sistema OS</h3>
  <a href="index.html">Entrada</a>
  <a href="clientes.html">Clientes</a>
  <a href="visualizar-os.html">Visualizar OS</a>
  <a href="financeiro.html">Financeiro</a>
</div>

<div class="main">

  <!-- RESUMO -->
  <div class="card resumo">
    <div class="box recebido">
      <h3>Total Recebido</h3>
      <h1 id="totalRecebido">R$ 0,00</h1>
    </div>

    <div class="box receber">
      <h3>Total a Receber</h3>
      <h1 id="totalReceber">R$ 0,00</h1>
    </div>
  </div>

  <!-- TABELA FINANCEIRA -->
  <div class="card">
    <h2>Detalhamento Financeiro</h2>
    <table>
      <thead>
        <tr>
          <th>OS</th>
          <th>Cliente</th>
          <th>Status</th>
          <th>Valor (R$)</th>
          <th>SituaÃ§Ã£o</th>
        </tr>
      </thead>
      <tbody id="tabelaFinanceiro"></tbody>
    </table>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBSQrG5bdCGC_6kUQxccgJxz2gtLiB2Kb4",
  authDomain: "sistema-os-1284b.firebaseapp.com",
  projectId: "sistema-os-1284b",
  storageBucket: "sistema-os-1284b.appspot.com",
  messagingSenderId: "1032102605721",
  appId: "1:1032102605721:web:7eba5fc6e4eb9fc17ad908"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const osCollection = collection(db, "os");

async function carregarFinanceiro() {
  let totalRecebido = 0;
  let totalReceber = 0;

  const tbody = document.getElementById("tabelaFinanceiro");
  tbody.innerHTML = "";

  const snap = await getDocs(osCollection);
  snap.forEach(docSnap => {
    const os = docSnap.data();
    const valor = Number(os.valor) || 150;

    let situacao = "A receber";

    if(os.status === "ConcluÃ­do" || os.financeiroStatus === "recebido") {
      totalRecebido += valor;
      situacao = "Recebido";
    } else {
      totalReceber += valor;
    }

    tbody.innerHTML += `
      <tr>
        <td>${os.osnum}</td>
        <td>${os.cliente}</td>
        <td>${os.status}</td>
        <td>R$ ${valor.toFixed(2)}</td>
        <td>${situacao}</td>
      </tr>
    `;
  });

  document.getElementById("totalRecebido").innerText =
    `R$ ${totalRecebido.toFixed(2)}`;
  document.getElementById("totalReceber").innerText =
    `R$ ${totalReceber.toFixed(2)}`;
}

carregarFinanceiro();
</script>

</body>
</html>
