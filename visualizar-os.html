<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Visualizar OS</title>

<style>
:root {
  --bg-color: #0f172a;
  --primary: #2563eb;
  --secondary: #1e293b;
  --card-bg: #ffffff;
  --text-color: #f1f5f9;
  --hover: #334155;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  display: flex;
  background: #f1f5f9;
}

.sidebar {
  width: 240px;
  height: 100vh;
  background: var(--bg-color);
  color: var(--text-color);
  padding: 20px;
  position: fixed;
}

.sidebar h2 {
  text-align: center;
  margin-bottom: 30px;
}

.sidebar a {
  display: block;
  padding: 12px;
  margin-bottom: 10px;
  color: var(--text-color);
  text-decoration: none;
  border-radius: 8px;
  font-weight: 600;
}

.sidebar a:hover { background: var(--hover); }

.main {
  margin-left: 240px;
  padding: 30px;
  flex: 1;
}

.card {
  background: var(--card-bg);
  padding: 25px;
  border-radius: 14px;
  box-shadow: 0 10px 20px rgba(0,0,0,0.08);
  margin-bottom: 25px;
}

h3 {
  margin-top: 0;
  border-left: 5px solid var(--primary);
  padding-left: 10px;
}

input, select, textarea {
  width: 100%;
  padding: 8px;
  margin-top: 8px;
  border-radius: 6px;
  border: 1px solid #cbd5e1;
}

textarea { resize: none; }

button {
  margin-top: 10px;
  padding: 10px;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  color: #fff;
}

.btn-primary { background: var(--primary); }
.btn-primary:hover { background: #1e40af; }

.btn-danger { background: #64748b; }
.btn-danger:hover { background: #475569; }
</style>
</head>

<body>

<div class="sidebar">
  <h2>üõ† Sistema OS</h2>
  <a href="index.html">Entrada de Equipamento</a>
  <a href="clientes.html">Cadastro de Clientes</a>
  <a href="visualizar-os.html">Visualizar OS</a>
  <a href="financeiro.html">Financeiro</a>
  <a href="produtos.html">Produtos</a>
  <a href="backup.html">Backup / Restaurar</a>
</div>

<div class="main">
  <div class="card">
    <h3>Ordens de Servi√ßo</h3>
    <div id="listaOS"></div>
  </div>
</div>

<!-- üî• FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  updateDoc,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBSQrG5bdCGC_6kUQxccgJxz2gtLiB2Kb4",
  authDomain: "sistema-os-1284b.firebaseapp.com",
  projectId: "sistema-os-1284b",
  storageBucket: "sistema-os-1284b.appspot.com",
  messagingSenderId: "1032102605721",
  appId: "1:1032102605721:web:7eba5fc6e4eb9fc17ad908"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const listaOS = document.getElementById("listaOS");

// LISTAR OS
async function carregarOS() {
  listaOS.innerHTML = "";
  const snapshot = await getDocs(collection(db, "os"));

  snapshot.forEach(docSnap => {
    const o = docSnap.data();
    const id = docSnap.id;

    listaOS.innerHTML += `
      <div class="card">
        <b>OS:</b><input id="osnum-${id}" value="${o.osnum}">
        <b>Cliente:</b><input id="cliente-${id}" value="${o.cliente}">
        <b>Telefone:</b><input id="telefone-${id}" value="${o.telefone}">
        <b>Endere√ßo:</b><input id="endereco-${id}" value="${o.endereco}">
        <b>Status:</b>
        <select id="status-${id}">
          <option ${o.status=="Pendente"?'selected':''}>Pendente</option>
          <option ${o.status=="Em bancada"?'selected':''}>Em bancada</option>
          <option ${o.status=="Or√ßamento pronto"?'selected':''}>Or√ßamento pronto</option>
          <option ${o.status=="Conclu√≠do"?'selected':''}>Conclu√≠do</option>
        </select>
        <b>Descri√ß√£o:</b><textarea id="desc-${id}">${o.descricao}</textarea>
        <b>Valor:</b><input type="number" id="valor-${id}" value="${o.valor}">
        <button class="btn-primary" onclick="atualizarOS('${id}')">Atualizar</button>
        <button class="btn-danger" onclick="excluirOS('${id}')">Excluir</button>
      </div>
    `;
  });
}

// ATUALIZAR
window.atualizarOS = async function(id) {
  await updateDoc(doc(db, "os", id), {
    osnum: document.getElementById(`osnum-${id}`).value,
    cliente: document.getElementById(`cliente-${id}`).value,
    telefone: document.getElementById(`telefone-${id}`).value,
    endereco: document.getElementById(`endereco-${id}`).value,
    status: document.getElementById(`status-${id}`).value,
    descricao: document.getElementById(`desc-${id}`).value,
    valor: document.getElementById(`valor-${id}`).value
  });
  alert("OS atualizada com sucesso!");
};

// EXCLUIR
window.excluirOS = async function(id) {
  if (confirm("Deseja excluir esta OS?")) {
    await deleteDoc(doc(db, "os", id));
    carregarOS();
  }
};

carregarOS();
</script>

</body>
</html>
