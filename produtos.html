<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Produtos e Servi√ßos</title>
<style>
:root {
  --bg-color: #f1f5f9;
  --sidebar-bg: #0f172a;
  --primary: #2563eb;
  --hover: #334155;
  --card-bg: #fff;
  --text-color: #f1f5f9;
  --button-bg: #2563eb;
  --button-hover: #1e40af;
}
* { box-sizing: border-box; margin: 0; padding: 0; font-family: Arial, sans-serif; }

/* MENU LATERAL */
.sidebar {
  width: 240px; height: 100vh; background: var(--sidebar-bg);
  color: var(--text-color); display: flex; flex-direction: column;
  padding: 20px; position: fixed; transition: transform 0.3s ease;
}
.sidebar h3 { text-align: center; margin-bottom: 30px; font-size: 1.3em; }
.sidebar a {
  display: block; padding: 12px; margin-bottom: 5px;
  color: var(--text-color); text-decoration: none; border-radius: 6px; font-weight: 500;
}
.sidebar a:hover { background: var(--hover); }

/* BOT√ÉO MENU MOBILE */
.menu-toggle {
  display: none; position: fixed; top: 15px; left: 15px;
  background: var(--primary); border: none; padding: 10px 15px;
  color: #fff; border-radius: 6px; font-size: 16px; cursor: pointer; z-index: 1001;
}

/* CONTE√öDO PRINCIPAL */
.main { margin-left: 240px; padding: 30px; flex: 1; transition: margin-left 0.3s ease; }
.card { background: var(--card-bg); padding: 25px; border-radius: 14px; margin-bottom: 25px; box-shadow: 0 15px 30px rgba(0,0,0,0.05); }

/* T√çTULOS */
h3 { margin-top: 0; border-left: 5px solid var(--primary); padding-left: 10px; }

/* INPUTS E BOT√ïES */
input, select, textarea, button {
  width: 100%; padding: 10px; margin-top: 10px;
  border-radius: 8px; border: 1px solid #cbd5e1;
}
button { background: var(--button-bg); color: #fff; font-weight: bold; cursor: pointer; }
button:hover { background: var(--button-hover); }

/* TABELA */
table { width: 100%; border-collapse: collapse; margin-top: 20px; min-width: 400px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
th { background: #f1f5f9; }
img.produto-img { width: 80px; height: 60px; object-fit: cover; border-radius: 6px; }

/* RESPONSIVO */
@media(max-width:768px){
  .sidebar { transform: translateX(-260px); height: 100%; position: fixed; z-index: 1000; }
  .sidebar.show { transform: translateX(0); }
  .main { margin-left: 0; padding: 20px; }
  .menu-toggle { display: block; }
}
</style>
</head>
<body>

<button class="menu-toggle" onclick="toggleMenu()">‚ò∞ Menu</button>

<div class="sidebar" id="sidebar">
  <h3>üõ† Sistema OS</h3>
  <a href="index.html">Entrada de Equipamento</a>
  <a href="clientes.html">Cadastro de Clientes</a>
  <a href="visualizar-os.html">Visualizar OS</a>
  <a href="financeiro.html">Financeiro</a>
  <a href="produtos.html">Produtos</a>
  <a href="backup.html">Backup / Restaurar</a>
</div>

<div class="main">

  <!-- CADASTRO -->
  <div class="card">
    <h3>Cadastro de Produtos e Servi√ßos</h3>
    <input id="nome" placeholder="Nome">
    <textarea id="descricao" placeholder="Descri√ß√£o"></textarea>
    <input id="valor" type="number" placeholder="Valor (R$)">
    <input id="foto" placeholder="URL da foto">
    <select id="categoria">
      <option value="servico">Servi√ßo</option>
      <option value="produto">Produto</option>
    </select>
    <label><input type="checkbox" id="ativo" checked> Ativo na loja</label>
    <button id="salvarProduto">Salvar Produto</button>
  </div>

  <!-- LISTA DE PRODUTOS -->
  <div class="card">
    <h3>Produtos Cadastrados</h3>
    <div style="overflow-x:auto">
      <table>
        <thead>
          <tr>
            <th>Foto</th><th>Nome</th><th>Descri√ß√£o</th><th>Valor</th><th>Categoria</th><th>Ativo</th><th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="lista"></tbody>
      </table>
    </div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBSQrG5bdCGC_6kUQxccgJxz2gtLiB2Kb4",
  authDomain: "sistema-os-1284b.firebaseapp.com",
  projectId: "sistema-os-1284b",
  storageBucket: "sistema-os-1284b.appspot.com",
  messagingSenderId: "1032102605721",
  appId: "1:1032102605721:web:7eba5fc6e4eb9fc17ad908"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function salvarProduto(id) {
  const produto = {
    nome: document.getElementById("nome").value,
    descricao: document.getElementById("descricao").value,
    valor: Number(document.getElementById("valor").value),
    foto: document.getElementById("foto").value,
    categoria: document.getElementById("categoria").value,
    ativo: document.getElementById("ativo").checked
  };
  if(!produto.nome || !produto.valor){ alert("Preencha nome e valor"); return; }

  try{
    if(id){ await updateDoc(doc(db,"produtos",id),produto); }
    else{ await addDoc(collection(db,"produtos"),produto); }
    limparFormulario(); carregarProdutos();
    alert("Produto salvo com sucesso!");
  }catch(e){ console.error("Erro ao salvar produto:",e); }
}

function limparFormulario(){
  document.getElementById("nome").value="";
  document.getElementById("descricao").value="";
  document.getElementById("valor").value="";
  document.getElementById("foto").value="";
  document.getElementById("categoria").value="servico";
  document.getElementById("ativo").checked=true;
  document.getElementById("salvarProduto").dataset.editId="";
}

async function carregarProdutos(){
  const lista = document.getElementById("lista");
  lista.innerHTML="";
  const snapshot = await getDocs(collection(db,"produtos"));
  snapshot.forEach(docSnap=>{
    const p = docSnap.data();
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td><img src="${p.foto||'https://via.placeholder.com/80'}" class="produto-img"></td>
      <td>${p.nome}</td>
      <td>${p.descricao||''}</td>
      <td>R$ ${Number(p.valor).toFixed(2)}</td>
      <td>${p.categoria}</td>
      <td>${p.ativo?'Sim':'N√£o'}</td>
      <td>
        <button onclick="editarProduto('${docSnap.id}')">Editar</button>
        <button onclick="deletarProduto('${docSnap.id}')">Excluir</button>
      </td>`;
    lista.appendChild(tr);
  });
}

window.editarProduto = async function(id){
  const snapshot = await getDocs(collection(db,"produtos"));
  const docSnap = snapshot.docs.find(d=>d.id===id);
  const p = docSnap.data();
  document.getElementById("nome").value=p.nome;
  document.getElementById("descricao").value=p.descricao;
  document.getElementById("valor").value=p.valor;
  document.getElementById("foto").value=p.foto;
  document.getElementById("categoria").value=p.categoria;
  document.getElementById("ativo").checked=p.ativo;
  document.getElementById("salvarProduto").dataset.editId=id;
}

window.deletarProduto = async function(id){
  if(confirm("Deseja realmente excluir este produto?")){
    await deleteDoc(doc(db,"produtos",id));
    carregarProdutos();
  }
}

document.getElementById("salvarProduto").onclick = ()=> salvarProduto(document.getElementById("salvarProduto").dataset.editId);

carregarProdutos();

// MENU MOBILE
function toggleMenu(){ document.getElementById('sidebar').classList.toggle('show'); }

</script>
</body>
</html>
