<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema OS - Produtos e Servi√ßos</title>
<style>
:root {
  --bg-color: #f1f5f9;
  --primary: #2563eb;
  --card-bg: #ffffff;
  --text-color: #0f172a;
  --hover: #e2e8f0;
  --button-bg: #2563eb;
  --button-hover: #1e40af;
}
body { margin: 0; font-family: "Segoe UI", Arial, sans-serif; background: var(--bg-color); color: var(--text-color);}
.sidebar { width: 240px; height: 100vh; background: #0f172a; color: #f1f5f9; display: flex; flex-direction: column; padding: 20px; position: fixed;}
.sidebar h2 { text-align: center; margin-bottom: 30px;}
.sidebar a { padding: 12px; margin-bottom: 10px; color: #f1f5f9; text-decoration: none; border-radius: 8px; font-weight: 600;}
.sidebar a:hover { background: #334155; }
.main { margin-left: 240px; padding: 30px; }
.card { background: var(--card-bg); padding: 25px; border-radius: 14px; box-shadow: 0 10px 20px rgba(0,0,0,.1); }
h3 { margin-top: 0; border-left: 5px solid var(--primary); padding-left: 10px; }
input, textarea, select, button { width: 100%; padding: 10px; margin-top: 10px; border-radius: 8px; border: 1px solid #cbd5e1; }
button { background: var(--button-bg); color: #fff; font-weight: bold; cursor: pointer; }
button:hover { background: var(--button-hover); }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #cbd5e1; padding: 10px; }
img.produto-img { width: 100px; height: 80px; object-fit: cover; border-radius: 6px; }
</style>
</head>

<body>

<div class="sidebar">
  <h3>üõ† Sistema OS</h3>
  <a href="index.html">Entrada de Equipamento</a>
  <a href="clientes.html">Cadastro de Clientes</a>
  <a href="visualizar-os.html">Visualizar OS</a>
  <a href="financeiro.html">Financeiro</a>
  <a href="produtos.html">Produtos</a>
  <a href="backup.html">Backup / Restaurar</a>
</div>

<div class="main">
  <div class="card">
    <h3>Cadastro de Produtos e Servi√ßos</h3>

    <input id="nome" placeholder="Nome">
    <textarea id="descricao" placeholder="Descri√ß√£o"></textarea>
    <input id="valor" type="number" placeholder="Valor (R$)">
    <input id="foto" placeholder="URL da foto">
    <select id="categoria">
      <option value="servico">Servi√ßo</option>
      <option value="produto">Produto</option>
    </select>
    <button onclick="adicionarProduto()">Adicionar Produto</button>

    <table>
      <thead>
        <tr>
          <th>Foto</th>
          <th>Nome</th>
          <th>Descri√ß√£o</th>
          <th>Valor</th>
          <th>Categoria</th>
        </tr>
      </thead>
      <tbody id="lista"></tbody>
    </table>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// üî• Config Firebase corrigida
const firebaseConfig = { 
  apiKey: "AIzaSyBSQrG5bdCGC_6kUQxccgJxz2gtLiB2Kb4", 
  authDomain: "sistema-os-1284b.firebaseapp.com",
  projectId: "sistema-os-1284b",
  storageBucket: "sistema-os-1284b.appspot.com", 
  messagingSenderId: "1032102605721", 
  appId: "1:1032102605721:web:7eba5fc6e4eb9fc17ad908"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ‚ûï Adicionar produto
window.adicionarProduto = async function () {
  const nomeEl = document.getElementById("nome");
  const descricaoEl = document.getElementById("descricao");
  const valorEl = document.getElementById("valor");
  const fotoEl = document.getElementById("foto");
  const categoriaEl = document.getElementById("categoria");

  if (!nomeEl.value || !valorEl.value) {
    alert("Preencha nome e valor!");
    return;
  }

  const produto = {
    nome: nomeEl.value,
    descricao: descricaoEl.value,
    valor: Number(valorEl.value),
    foto: fotoEl.value,
    categoria: categoriaEl.value,
    ativo: true
  };

  try {
    await addDoc(collection(db, "produtos"), produto);
    alert("Produto salvo com sucesso!");
    
    // limpar campos
    nomeEl.value = "";
    descricaoEl.value = "";
    valorEl.value = "";
    fotoEl.value = "";
    categoriaEl.value = "servico";

    carregarProdutos();
  } catch(e) {
    alert("Erro ao salvar produto: " + e.message);
  }
};

// üì• Carregar produtos
async function carregarProdutos() {
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  const snapshot = await getDocs(collection(db, "produtos"));
  snapshot.forEach(doc => {
    const p = doc.data();
    lista.innerHTML += `
      <tr>
        <td><img src="${p.foto || 'https://via.placeholder.com/100'}" class="produto-img"></td>
        <td>${p.nome}</td>
        <td>${p.descricao || ''}</td>
        <td>R$ ${p.valor.toFixed(2)}</td>
        <td>${p.categoria}</td>
      </tr>
    `;
  });
}

// Inicializa a lista
carregarProdutos();
</script>

</body>
</html>
